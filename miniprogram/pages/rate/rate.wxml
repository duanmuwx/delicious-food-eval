<view class="container" wx:if="{{!loading}}">
  <!-- èœå“ä¿¡æ¯ -->
  <view class="dish-header card">
    <block wx:if="{{dish.imageFileId}}">
      <image
        class="dish-detail-image"
        src="{{dish.imageFileId}}"
        mode="aspectFill"
      />
      <text wx:if="{{dish.imageContributorName}}" class="contributor-text">å›¾ç‰‡ç”± {{dish.imageContributorName}} æä¾›</text>
    </block>
    <view wx:else class="upload-guide" bindtap="onUploadImage">
      <view class="upload-guide-icon">ğŸ“·</view>
      <text class="upload-guide-text">è¿™é“èœè¿˜æ²¡æœ‰å›¾ç‰‡ï¼Œæ‹ä¸€å¼ å§</text>
      <text wx:if="{{imageUploading}}" class="upload-guide-hint">ä¸Šä¼ ä¸­...</text>
    </view>
    <text class="dish-detail-name">{{dish.name}}</text>
    <view class="dish-detail-stats">
      <text class="avg-score">{{dish.avgScore > 0 ? dish.avgScore.toFixed(1) : 'æš‚æ— è¯„åˆ†'}}</text>
      <text class="rating-count-text">{{dish.ratingCount || 0}}äººå·²è¯„</text>
    </view>
  </view>

  <!-- è¯„åˆ†åŒºåŸŸ -->
  <view class="rating-section card">
    <text class="section-title">{{existingRatingId ? 'ä¿®æ”¹æˆ‘çš„è¯„åˆ†' : 'æˆ‘æ¥è¯„åˆ†'}}</text>
    <view class="star-row">
      <star-rating value="{{myScore}}" size="{{60}}" bind:change="onScoreChange" />
      <text class="score-display" wx:if="{{myScore > 0}}">{{myScore}}åˆ†</text>
    </view>
    <view class="comment-area">
      <textarea
        class="comment-input"
        placeholder="è¯´ç‚¹ä»€ä¹ˆå§ï¼ˆé€‰å¡«ï¼Œ50å­—ä»¥å†…ï¼‰"
        maxlength="50"
        value="{{myComment}}"
        bindinput="onCommentInput"
      />
      <text class="char-count">{{myComment.length}}/50</text>
    </view>
    <button
      class="btn-primary submit-btn"
      bindtap="onSubmit"
      disabled="{{submitting || myScore === 0}}"
    >
      {{submitting ? 'æäº¤ä¸­...' : (existingRatingId ? 'ä¿®æ”¹è¯„åˆ†' : 'æäº¤è¯„åˆ†')}}
    </button>
  </view>

  <!-- æŸ¥çœ‹è¯„è®ºå…¥å£ -->
  <view class="view-comments-section" bindtap="onViewComments">
    <text class="view-comments-text">æŸ¥çœ‹å…¶ä»–è¯„è®º</text>
    <text class="view-comments-arrow">â€º</text>
  </view>
</view>

<view wx:else class="loading-wrap">
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>
