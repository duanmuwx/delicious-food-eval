<view class="container">
  <!-- 用户资料区域 -->
  <view class="profile-section card" bindtap="goProfile">
    <view class="profile-info">
      <image
        class="profile-avatar"
        wx:if="{{avatarUrl}}"
        src="{{avatarUrl}}"
        mode="aspectFill"
      />
      <view class="profile-avatar profile-avatar-default" wx:else>
        <text class="profile-avatar-text">{{hasProfile ? nickName[0] : '?'}}</text>
      </view>
      <view class="profile-detail">
        <text class="profile-name" wx:if="{{hasProfile}}">{{nickName}}</text>
        <text class="profile-name profile-name-placeholder" wx:else>点击设置个人资料</text>
        <text class="profile-tip" wx:if="{{!hasProfile}}">设置昵称后评论将显示你的昵称</text>
      </view>
    </view>
    <text class="profile-arrow">></text>
  </view>

  <!-- 管理员入口 -->
  <view wx:if="{{isAdmin}}" class="admin-entry card" bindtap="goAdmin">
    <text class="admin-icon">⚙️</text>
    <text class="admin-text">菜品管理</text>
    <text class="admin-arrow">></text>
  </view>

  <!-- 评分历史 -->
  <view class="section">
    <view class="section-title">我的评分历史</view>

    <view wx:if="{{loading}}" class="loading-wrap">
      <text class="loading-text">加载中...</text>
    </view>

    <block wx:else>
      <view wx:if="{{ratingHistory.length > 0}}" class="history-list">
        <view
          class="history-item card"
          wx:for="{{ratingHistory}}"
          wx:key="_id"
        >
          <view class="history-header">
            <text class="history-dish-name">{{item.dishName}}</text>
            <text class="history-date">{{item.dateDisplay}}</text>
          </view>
          <view class="history-body">
            <view class="history-stars">
              <text
                wx:for="{{[1,2,3,4,5]}}"
                wx:for-item="star"
                wx:for-index="idx"
                wx:key="*this"
                class="star-char {{idx < item.score ? 'active' : ''}}"
              >★</text>
              <text class="history-score">{{item.score}}分</text>
            </view>
            <text wx:if="{{item.comment}}" class="history-comment">{{item.comment}}</text>
            <view class="history-actions">
              <view
                class="delete-rating-btn"
                data-rating-id="{{item._id}}"
                data-dish-id="{{item.dishId}}"
                catchtap="onDeleteRating"
              >删除</view>
            </view>
          </view>
        </view>
      </view>
      <empty-state wx:else message="还没有评分记录" />
    </block>
  </view>
</view>
