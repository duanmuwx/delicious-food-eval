<view class="container">
  <!-- 菜品信息头部 -->
  <view wx:if="{{dish}}" class="dish-header card">
    <image
      class="dish-image"
      wx:if="{{dish.imageFileId}}"
      src="{{dish.imageFileId}}"
      mode="aspectFill"
    />
    <view class="dish-image dish-image-placeholder" wx:else>
      <text class="placeholder-text">暂无图片</text>
    </view>
    <view class="dish-info">
      <text class="dish-name">{{dish.name}}</text>
      <view class="dish-stats">
        <star-rating value="{{dish.avgScore}}" readonly="{{true}}" size="28" />
        <text class="dish-score">{{dish.avgScoreText}}分</text>
      </view>
      <text class="dish-count">{{dish.ratingCount}}人评价</text>
    </view>
  </view>

  <!-- 加载中 -->
  <view wx:if="{{loading}}" class="loading-wrap">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 评论列表 -->
  <block wx:else>
    <view class="section-title">全部评论 ({{comments.length}})</view>

    <view wx:if="{{comments.length > 0}}" class="comment-list">
      <view
        class="comment-item card"
        wx:for="{{comments}}"
        wx:key="_id"
      >
        <view class="comment-header">
          <view class="comment-user">
            <image
              class="user-avatar"
              wx:if="{{item.avatarUrl}}"
              src="{{item.avatarUrl}}"
              mode="aspectFill"
            />
            <view class="user-avatar user-avatar-default" wx:else>
              <text class="avatar-text">{{item.nickName[0] || '匿'}}</text>
            </view>
            <text class="user-name">{{item.nickName}}</text>
          </view>
          <text class="comment-date">{{item.dateText}}</text>
        </view>
        <view class="comment-body">
          <view class="comment-stars">
            <text
              wx:for="{{[1,2,3,4,5]}}"
              wx:for-item="star"
              wx:for-index="idx"
              wx:key="*this"
              class="star-char {{idx < item.score ? 'active' : ''}}"
            >★</text>
            <text class="comment-score">{{item.score}}分</text>
          </view>
          <text wx:if="{{item.comment}}" class="comment-text">{{item.comment}}</text>
        </view>
      </view>
    </view>
    <empty-state wx:else message="暂无评论" />
  </block>
</view>
